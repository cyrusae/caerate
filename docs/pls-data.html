<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 PLS data | PLS/E-Rate wrangling overview</title>
  <meta name="description" content="3 PLS data | PLS/E-Rate wrangling overview" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="3 PLS data | PLS/E-Rate wrangling overview" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 PLS data | PLS/E-Rate wrangling overview" />
  
  
  

<meta name="author" content="Cyrus Eosphoros" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="logic.html"/>
<link rel="next" href="e-rate-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this document</a></li>
<li class="chapter" data-level="2" data-path="logic.html"><a href="logic.html"><i class="fa fa-check"></i><b>2</b> Logic</a>
<ul>
<li class="chapter" data-level="2.1" data-path="logic.html"><a href="logic.html#contents"><i class="fa fa-check"></i><b>2.1</b> Contents</a></li>
<li class="chapter" data-level="2.2" data-path="logic.html"><a href="logic.html#back-up-a-second"><i class="fa fa-check"></i><b>2.2</b> Back up a second</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="logic.html"><a href="logic.html#second-guessing"><i class="fa fa-check"></i><b>2.2.1</b> Second-guessing</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="logic.html"><a href="logic.html#important-things-to-know"><i class="fa fa-check"></i><b>2.3</b> Important things to know</a></li>
<li class="chapter" data-level="2.4" data-path="logic.html"><a href="logic.html#so-packages"><i class="fa fa-check"></i><b>2.4</b> So: packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pls-data.html"><a href="pls-data.html"><i class="fa fa-check"></i><b>3</b> PLS data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="pls-data.html"><a href="pls-data.html#some-libraries-here-and-why-to-use-them"><i class="fa fa-check"></i><b>3.1</b> Some libraries here and why to use them</a></li>
<li class="chapter" data-level="3.2" data-path="pls-data.html"><a href="pls-data.html#pls-download-and-cleaning-utilities"><i class="fa fa-check"></i><b>3.2</b> PLS download and cleaning utilities</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="e-rate-data.html"><a href="e-rate-data.html"><i class="fa fa-check"></i><b>4</b> E-Rate data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="e-rate-data.html"><a href="e-rate-data.html#socrata-and-performance"><i class="fa fa-check"></i><b>4.1</b> Socrata and performance</a></li>
<li class="chapter" data-level="4.2" data-path="e-rate-data.html"><a href="e-rate-data.html#why-is-all-of-the-above-important"><i class="fa fa-check"></i><b>4.2</b> Why is all of the above important?</a></li>
<li class="chapter" data-level="4.3" data-path="e-rate-data.html"><a href="e-rate-data.html#what-next"><i class="fa fa-check"></i><b>4.3</b> What next?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="architecture.html"><a href="architecture.html"><i class="fa fa-check"></i><b>5</b> Architecture</a>
<ul>
<li class="chapter" data-level="5.1" data-path="architecture.html"><a href="architecture.html#second-drafts"><i class="fa fa-check"></i><b>5.1</b> Second drafts</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">PLS/E-Rate wrangling overview</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pls-data" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> PLS data<a href="pls-data.html#pls-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Important things to know: PLS data has idiosyncratic flags for blanks/NAs that will bias how R interprets columns of their data. Their filenames and the structure of the <code>.zip</code>s the IMLS releases can vary from year to year. The website they’re on is pretty stable but doesn’t have a machine-accessible API.</p>
<div id="some-libraries-here-and-why-to-use-them" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Some libraries here and why to use them<a href="pls-data.html#some-libraries-here-and-why-to-use-them" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><strong>furrr</strong>: helps with performance and making code legible by making it easier to <a href="https://cran.r-project.org/web/packages/furrr/index.html">run the same functions on a vector in parallel</a>.</li>
<li><strong>rvest</strong>: <a href="https://cran.r-project.org/web/packages/rvest/index.html">scrapes</a> the underlying HTML of the IMLS public-facing site so we can find the links we need.</li>
<li><strong>assertthat</strong>: this enforces <a href="https://cran.r-project.org/web/packages/assertthat/index.html">data being a certain “shape”</a></li>
<li><strong>data.table</strong>: <a href="https://cran.r-project.org/web/packages/data.table/index.html">makes everything much faster</a>.</li>
</ul>
<p>Some caveats:</p>
<ul>
<li>The code as written uses <strong>here</strong>, which is a package intended for interactive use. It should be replaced with <strong>rprojroot</strong> in practice.</li>
<li>I was using base <code>download.file</code> here; <strong>curl</strong> is faster and cleaner.</li>
</ul>
</div>
<div id="pls-download-and-cleaning-utilities" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> PLS download and cleaning utilities<a href="pls-data.html#pls-download-and-cleaning-utilities" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Comments with <code>#'</code> are taking advantage of a Roxygen documentation skeleton (see arguments for package-shaped development). Key functions from the <code>pls.R</code> file:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="pls-data.html#cb26-1" tabindex="-1"></a><span class="co">#&#39; Retrieve URLs from IMLS</span></span>
<span id="cb26-2"><a href="pls-data.html#cb26-2" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb26-3"><a href="pls-data.html#cb26-3" tabindex="-1"></a><span class="co">#&#39; @description</span></span>
<span id="cb26-4"><a href="pls-data.html#cb26-4" tabindex="-1"></a><span class="co">#&#39; Hits the IMLS page for PLS data dumps and returns a vector of URLs we want to download.</span></span>
<span id="cb26-5"><a href="pls-data.html#cb26-5" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb26-6"><a href="pls-data.html#cb26-6" tabindex="-1"></a><span class="co">#&#39; @details</span></span>
<span id="cb26-7"><a href="pls-data.html#cb26-7" tabindex="-1"></a><span class="co">#&#39; Future-proofing concerns: this works as long as the IMLS keeps putting things on their website as it worked in 2023 and don&#39;t come up with a new name scheme for files. If they do the latter, consider searching for a) links to zip files and b) links closest to the string &#39;CSV&#39;--it works now because the CSVs are the first/default option. Their file name scheme has been consistent since 2014, which happily enough is the timeframe TASCHA wants anyway, but if you want to go back further the parameter to change is `grepl` (consider trying `&#39;*.zip&#39;`, maybe).</span></span>
<span id="cb26-8"><a href="pls-data.html#cb26-8" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb26-9"><a href="pls-data.html#cb26-9" tabindex="-1"></a><span class="co">#&#39; @param url Full address of the page on the IMLS site to retrieve download URLs from. Currently `&#39;https://www.imls.gov/research-evaluation/data-collection/public-libraries-survey&#39;`. (Is a parameter to allow for unit testing, if this changes we probably have bigger problems.)</span></span>
<span id="cb26-10"><a href="pls-data.html#cb26-10" tabindex="-1"></a><span class="co">#&#39; @param site IMLS site the download URLs expect as a prefix (`&#39;https://www.imls.gov&#39;`). Above parenthetical applies!</span></span>
<span id="cb26-11"><a href="pls-data.html#cb26-11" tabindex="-1"></a><span class="co">#&#39; @param xpath Node from the IMLS page to look for results in. At time of writing the one that works is `&#39;//*[@data-ui-role=&quot;accordion&quot;]&#39;`. Used as `xpath` input for `rvest`.</span></span>
<span id="cb26-12"><a href="pls-data.html#cb26-12" tabindex="-1"></a><span class="co">#&#39; @param element Element to retrieve contents of. Used as input for `rvest`. Default `&#39;a&#39;` (we are looking for links).</span></span>
<span id="cb26-13"><a href="pls-data.html#cb26-13" tabindex="-1"></a><span class="co">#&#39; @param grepl Regex identifying a file that&#39;s relevant. Default `&#39;*pls_fy&#39;` (returns 2014-present because that happens to be how long they&#39;ve been consistently using that).</span></span>
<span id="cb26-14"><a href="pls-data.html#cb26-14" tabindex="-1"></a><span class="co">#&#39; @param extract Regex to determine name scheme for FY extraction. Default `&#39;fy20..&#39;` (produces results like `&#39;fy2045&#39;`).</span></span>
<span id="cb26-15"><a href="pls-data.html#cb26-15" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb26-16"><a href="pls-data.html#cb26-16" tabindex="-1"></a><span class="co">#&#39; @returns A named character vector of URLs to download and their corresponding reporting years.</span></span>
<span id="cb26-17"><a href="pls-data.html#cb26-17" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb26-18"><a href="pls-data.html#cb26-18" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb26-19"><a href="pls-data.html#cb26-19" tabindex="-1"></a>get_pls_urls <span class="ot">&lt;-</span> \(<span class="at">url =</span> <span class="st">&#39;https://www.imls.gov/research-evaluation/data-collection/public-libraries-survey&#39;</span>,</span>
<span id="cb26-20"><a href="pls-data.html#cb26-20" tabindex="-1"></a>                  <span class="at">site =</span> <span class="st">&#39;https://www.imls.gov&#39;</span>,</span>
<span id="cb26-21"><a href="pls-data.html#cb26-21" tabindex="-1"></a>                  <span class="at">xpath =</span> <span class="st">&#39;//*[@data-ui-role=&quot;accordion&quot;]&#39;</span>,</span>
<span id="cb26-22"><a href="pls-data.html#cb26-22" tabindex="-1"></a>                  <span class="at">element =</span> <span class="st">&#39;a&#39;</span>,</span>
<span id="cb26-23"><a href="pls-data.html#cb26-23" tabindex="-1"></a>                  <span class="at">grepl =</span> <span class="st">&#39;*pls_fy&#39;</span>,</span>
<span id="cb26-24"><a href="pls-data.html#cb26-24" tabindex="-1"></a>                  <span class="at">extract =</span> <span class="st">&#39;fy20..&#39;</span>) {</span>
<span id="cb26-25"><a href="pls-data.html#cb26-25" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co"> validate inputs on principle</span></span>
<span id="cb26-26"><a href="pls-data.html#cb26-26" tabindex="-1"></a>  pls <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">read_html</span>(url) <span class="sc">%&gt;%</span></span>
<span id="cb26-27"><a href="pls-data.html#cb26-27" tabindex="-1"></a>    rvest<span class="sc">::</span><span class="fu">html_nodes</span>(<span class="at">xpath =</span> xpath) <span class="sc">%&gt;%</span></span>
<span id="cb26-28"><a href="pls-data.html#cb26-28" tabindex="-1"></a>    rvest<span class="sc">::</span><span class="fu">html_children</span>() <span class="sc">%&gt;%</span> <span class="co">#the node contains years</span></span>
<span id="cb26-29"><a href="pls-data.html#cb26-29" tabindex="-1"></a>    rvest<span class="sc">::</span><span class="fu">html_element</span>(element) <span class="sc">%&gt;%</span> <span class="co">#get the first link</span></span>
<span id="cb26-30"><a href="pls-data.html#cb26-30" tabindex="-1"></a>    rvest<span class="sc">::</span><span class="fu">html_attrs</span>() <span class="co">#get the url that link refers to</span></span>
<span id="cb26-31"><a href="pls-data.html#cb26-31" tabindex="-1"></a>  pls <span class="ot">&lt;-</span> pls[<span class="fu">grepl</span>(grepl, pls)] <span class="co">#reduce to real links</span></span>
<span id="cb26-32"><a href="pls-data.html#cb26-32" tabindex="-1"></a>  pls <span class="ot">&lt;-</span> <span class="fu">paste0</span>(site, pls) <span class="co">#list of download URLs for zip files</span></span>
<span id="cb26-33"><a href="pls-data.html#cb26-33" tabindex="-1"></a>  <span class="fu">names</span>(pls) <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(pls, extract) <span class="co">#list now has name of the FY each URL is for</span></span>
<span id="cb26-34"><a href="pls-data.html#cb26-34" tabindex="-1"></a>  pls <span class="co">#return list (character vector) of URLs with their FYs as names</span></span>
<span id="cb26-35"><a href="pls-data.html#cb26-35" tabindex="-1"></a>}</span></code></pre></div>
<p>This part is important: replaces things that aren’t real values according to the PLS documentation with NAs that R can recognize.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="pls-data.html#cb27-1" tabindex="-1"></a><span class="co">#&#39; @param file Path to file (inherited from wrapper function).</span></span>
<span id="cb27-2"><a href="pls-data.html#cb27-2" tabindex="-1"></a><span class="co">#&#39; @param response Either &#39;outlet&#39; or &#39;admin&#39;.</span></span>
<span id="cb27-3"><a href="pls-data.html#cb27-3" tabindex="-1"></a><span class="co">#&#39; @param fy Expects `fy20..` format used elsewhere.</span></span>
<span id="cb27-4"><a href="pls-data.html#cb27-4" tabindex="-1"></a><span class="co">#&#39; @param here See general concerns with `here` usage.</span></span>
<span id="cb27-5"><a href="pls-data.html#cb27-5" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb27-6"><a href="pls-data.html#cb27-6" tabindex="-1"></a><span class="co">#&#39; @returns The filepath for the single successfully written file.</span></span>
<span id="cb27-7"><a href="pls-data.html#cb27-7" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb27-8"><a href="pls-data.html#cb27-8" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb27-9"><a href="pls-data.html#cb27-9" tabindex="-1"></a>get_pls_csv <span class="ot">&lt;-</span> \(file, response, fy, here) {</span>
<span id="cb27-10"><a href="pls-data.html#cb27-10" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.readable</span>(file) <span class="co">#is the file readable?</span></span>
<span id="cb27-11"><a href="pls-data.html#cb27-11" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.writeable</span>(here<span class="sc">::</span><span class="fu">here</span>(here)) <span class="co">#is the destination writable?</span></span>
<span id="cb27-12"><a href="pls-data.html#cb27-12" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.string</span>(fy) <span class="co">#is the input fy coherent?</span></span>
<span id="cb27-13"><a href="pls-data.html#cb27-13" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.string</span>(response) <span class="co">#do we know what the response is?</span></span>
<span id="cb27-14"><a href="pls-data.html#cb27-14" tabindex="-1"></a>  dest <span class="ot">&lt;-</span> <span class="fu">paste0</span>(here<span class="sc">::</span><span class="fu">here</span>(here), <span class="st">&#39;/pls_&#39;</span>,</span>
<span id="cb27-15"><a href="pls-data.html#cb27-15" tabindex="-1"></a>                 response, <span class="st">&#39;_&#39;</span>, fy, <span class="st">&#39;.csv&#39;</span>)</span>
<span id="cb27-16"><a href="pls-data.html#cb27-16" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="at">file =</span> file)</span>
<span id="cb27-17"><a href="pls-data.html#cb27-17" tabindex="-1"></a>  dt[dt <span class="sc">==</span> <span class="sc">-</span><span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co">#Remove suppressed data</span></span>
<span id="cb27-18"><a href="pls-data.html#cb27-18" tabindex="-1"></a>  dt[dt <span class="sc">==</span> <span class="sc">-</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co">#Remove for closures</span></span>
<span id="cb27-19"><a href="pls-data.html#cb27-19" tabindex="-1"></a>  dt[dt <span class="sc">==</span> <span class="sc">-</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co">#Remove for closures</span></span>
<span id="cb27-20"><a href="pls-data.html#cb27-20" tabindex="-1"></a>  dt[dt <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co">#Remove unanswered questions</span></span>
<span id="cb27-21"><a href="pls-data.html#cb27-21" tabindex="-1"></a>  dt[dt <span class="sc">==</span> <span class="st">&#39;M&#39;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co">#Remove missing values</span></span>
<span id="cb27-22"><a href="pls-data.html#cb27-22" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&#39;MICROF&#39;</span> <span class="sc">%in%</span> <span class="fu">names</span>(dt)) dt[MICROF <span class="sc">==</span> <span class="st">&#39;N&#39;</span>, MICROF <span class="sc">:=</span> <span class="cn">NA</span>] <span class="co">#NA for the MICROF field only</span></span>
<span id="cb27-23"><a href="pls-data.html#cb27-23" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&#39;RSTATUS&#39;</span> <span class="sc">%in%</span> <span class="fu">names</span>(dt)) dt[RSTATUS <span class="sc">==</span> <span class="dv">3</span>, RSTATUS <span class="sc">:=</span> <span class="cn">NA</span>] <span class="co">#remove nonrespondents</span></span>
<span id="cb27-24"><a href="pls-data.html#cb27-24" tabindex="-1"></a>  data.table<span class="sc">::</span><span class="fu">fwrite</span>(dt, <span class="at">file =</span> dest)</span>
<span id="cb27-25"><a href="pls-data.html#cb27-25" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.readable</span>(<span class="at">path =</span> dest)</span>
<span id="cb27-26"><a href="pls-data.html#cb27-26" tabindex="-1"></a>  dest <span class="co">#return successfully-written file</span></span>
<span id="cb27-27"><a href="pls-data.html#cb27-27" tabindex="-1"></a>}</span></code></pre></div>
<p>The idiosyncratic PLS equivalents of NA:</p>
<ul>
<li>Negative numbers -9, -4, -3, and -1, which flag data suppressed for privacy reasons (libraries too small to be de-identified), temporary and permanent closures, and unanswered questions</li>
<li>The letter “M”, which is what they actually use for NA per se</li>
<li>“N”, but only in the MICROF column</li>
<li>The number 3 (closures), but only in the RSTATUS column</li>
</ul>
<p>Clearing these as soon as possible gets our columns in (hopefully) the right data type and means we can use the NAs to identify rows we don’t care about going forward (e.g. nonrespondents one year won’t have anything to tell us we didn’t see last year).</p>
<p>PLS-specific problem: a single year comes in a zip file that has three CSVs in it… somewhere. Possibly in a nested folder. With nonstandard filenames. <em>But:</em> one is always library outlets and is the longest, one is always state-level data and is the shortest, and one is always in the middle.</p>
<p>We can work with that!</p>
<p>Caveats about <code>curl</code> and <code>here</code> notwithstanding, these functions download files from the IMLS website, identify which CSV is which (we care about outlets and administrative entities), and save them in a more predictable structure.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="pls-data.html#cb28-1" tabindex="-1"></a><span class="co">#&#39; Retrieve CSVs from IMLS zip file</span></span>
<span id="cb28-2"><a href="pls-data.html#cb28-2" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb28-3"><a href="pls-data.html#cb28-3" tabindex="-1"></a><span class="co">#&#39; @description</span></span>
<span id="cb28-4"><a href="pls-data.html#cb28-4" tabindex="-1"></a><span class="co">#&#39; Download a single zip file from the IMLS website (if needed), extract only the contents that are CSV files, identify and rename the outlet and administrative entity PLS responses, and return the paths to those files while deleting the intermediary files.</span></span>
<span id="cb28-5"><a href="pls-data.html#cb28-5" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb28-6"><a href="pls-data.html#cb28-6" tabindex="-1"></a><span class="co">#&#39; @details</span></span>
<span id="cb28-7"><a href="pls-data.html#cb28-7" tabindex="-1"></a><span class="co">#&#39; Development concerns: Current use of `here` is more brittle than I want it to be but I haven&#39;t figured out what the better long-term way to handle that is.</span></span>
<span id="cb28-8"><a href="pls-data.html#cb28-8" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb28-9"><a href="pls-data.html#cb28-9" tabindex="-1"></a><span class="co">#&#39; @param url URL leading to a single zip of CSV files on the IMLS website (see `get_pls_urls()`).</span></span>
<span id="cb28-10"><a href="pls-data.html#cb28-10" tabindex="-1"></a><span class="co">#&#39; @param extract Regex to determine name scheme for FY extraction. Default `&#39;fy20..&#39;` (produces results like `&#39;fy2045&#39;`).</span></span>
<span id="cb28-11"><a href="pls-data.html#cb28-11" tabindex="-1"></a><span class="co">#&#39; @param here String describing the intended destination path. Default `&#39;data/raw/PLS_csvs&#39;`. Needs refinement as a feature.</span></span>
<span id="cb28-12"><a href="pls-data.html#cb28-12" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb28-13"><a href="pls-data.html#cb28-13" tabindex="-1"></a><span class="co">#&#39; @returns A named character vector of length 2 containing the paths to the admin and outlet PLS responses.</span></span>
<span id="cb28-14"><a href="pls-data.html#cb28-14" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb28-15"><a href="pls-data.html#cb28-15" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb28-16"><a href="pls-data.html#cb28-16" tabindex="-1"></a>get_pls_zip <span class="ot">&lt;-</span> \(<span class="at">url =</span> url,</span>
<span id="cb28-17"><a href="pls-data.html#cb28-17" tabindex="-1"></a>                 <span class="at">extract =</span> <span class="st">&#39;fy20..&#39;</span>,</span>
<span id="cb28-18"><a href="pls-data.html#cb28-18" tabindex="-1"></a>                 <span class="at">here =</span> <span class="st">&#39;data/raw/PLS_csvs&#39;</span>) {</span>
<span id="cb28-19"><a href="pls-data.html#cb28-19" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.string</span>(url) <span class="co">#Did we get a URL that we can ping</span></span>
<span id="cb28-20"><a href="pls-data.html#cb28-20" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.string</span>(here) <span class="co">#Is the desired path viable</span></span>
<span id="cb28-21"><a href="pls-data.html#cb28-21" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(<span class="fu">names</span>(url))) {</span>
<span id="cb28-22"><a href="pls-data.html#cb28-22" tabindex="-1"></a>    fy <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(url, extract)</span>
<span id="cb28-23"><a href="pls-data.html#cb28-23" tabindex="-1"></a>    assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">length</span>(fy) <span class="sc">==</span> <span class="fu">length</span>(extract))</span>
<span id="cb28-24"><a href="pls-data.html#cb28-24" tabindex="-1"></a>    <span class="fu">names</span>(url) <span class="ot">&lt;-</span> fy</span>
<span id="cb28-25"><a href="pls-data.html#cb28-25" tabindex="-1"></a>  }</span>
<span id="cb28-26"><a href="pls-data.html#cb28-26" tabindex="-1"></a>  fy <span class="ot">&lt;-</span> <span class="fu">names</span>(url) <span class="co">#Get the FY value out</span></span>
<span id="cb28-27"><a href="pls-data.html#cb28-27" tabindex="-1"></a>  fp <span class="ot">&lt;-</span> <span class="fu">paste0</span>(here<span class="sc">::</span><span class="fu">here</span>(here), <span class="st">&#39;/&#39;</span>, fy)</span>
<span id="cb28-28"><a href="pls-data.html#cb28-28" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(fp)) <span class="fu">dir.create</span>(fp) <span class="co">#Create directory if needed</span></span>
<span id="cb28-29"><a href="pls-data.html#cb28-29" tabindex="-1"></a>  <span class="co">#Note: still deciding whether we&#39;re keeping the zip files and deleting everything else or what</span></span>
<span id="cb28-30"><a href="pls-data.html#cb28-30" tabindex="-1"></a>  <span class="co">#TODO Add error handling once we&#39;re sure of cleanup steps</span></span>
<span id="cb28-31"><a href="pls-data.html#cb28-31" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.writeable</span>(fp) <span class="co">#Can we write to the directory</span></span>
<span id="cb28-32"><a href="pls-data.html#cb28-32" tabindex="-1"></a>  zipfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(fp, <span class="st">&#39;/&#39;</span>, fy, <span class="st">&#39;.zip&#39;</span>)</span>
<span id="cb28-33"><a href="pls-data.html#cb28-33" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(zipfile)) {</span>
<span id="cb28-34"><a href="pls-data.html#cb28-34" tabindex="-1"></a>    <span class="fu">download.file</span>(<span class="at">url =</span> url, <span class="at">destfile =</span> zipfile, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-35"><a href="pls-data.html#cb28-35" tabindex="-1"></a>  } <span class="co">#Download a file if it doesn&#39;t appear to exist yet</span></span>
<span id="cb28-36"><a href="pls-data.html#cb28-36" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.readable</span>(zipfile) <span class="co">#Did we get the zip successfully (or have it already)?</span></span>
<span id="cb28-37"><a href="pls-data.html#cb28-37" tabindex="-1"></a>  zip_contents <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">.csv$&#39;</span>, <span class="co">#find only the CSV files</span></span>
<span id="cb28-38"><a href="pls-data.html#cb28-38" tabindex="-1"></a>                       <span class="fu">unzip</span>(<span class="at">zipfile =</span> zipfile,</span>
<span id="cb28-39"><a href="pls-data.html#cb28-39" tabindex="-1"></a>                             <span class="at">list =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>Name, <span class="co">#Names only</span></span>
<span id="cb28-40"><a href="pls-data.html#cb28-40" tabindex="-1"></a>                       <span class="at">ignore.case =</span> <span class="cn">TRUE</span>, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-41"><a href="pls-data.html#cb28-41" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="at">zipfile =</span> zipfile, <span class="at">files =</span> zip_contents,</span>
<span id="cb28-42"><a href="pls-data.html#cb28-42" tabindex="-1"></a>        <span class="at">exdir =</span> fp) <span class="co">#put the CSV files in the /fy20XX/ directory</span></span>
<span id="cb28-43"><a href="pls-data.html#cb28-43" tabindex="-1"></a>  zip_contents <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> fp, <span class="at">pattern =</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">.csv$&#39;</span>,</span>
<span id="cb28-44"><a href="pls-data.html#cb28-44" tabindex="-1"></a>                             <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb28-45"><a href="pls-data.html#cb28-45" tabindex="-1"></a>                             <span class="at">include.dirs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-46"><a href="pls-data.html#cb28-46" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">length</span>(zip_contents) <span class="sc">==</span> <span class="dv">3</span>) <span class="co">#make sure there are specifically three CSV files here</span></span>
<span id="cb28-47"><a href="pls-data.html#cb28-47" tabindex="-1"></a>  zip_nrows <span class="ot">&lt;-</span> <span class="fu">check_nrows</span>(<span class="at">files =</span> zip_contents)</span>
<span id="cb28-48"><a href="pls-data.html#cb28-48" tabindex="-1"></a>  zip_results <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb28-49"><a href="pls-data.html#cb28-49" tabindex="-1"></a>    <span class="at">path =</span> zip_contents,</span>
<span id="cb28-50"><a href="pls-data.html#cb28-50" tabindex="-1"></a>    <span class="at">nrows =</span> zip_nrows</span>
<span id="cb28-51"><a href="pls-data.html#cb28-51" tabindex="-1"></a>  ) <span class="co">#track features about the files that we&#39;ll need in a bit</span></span>
<span id="cb28-52"><a href="pls-data.html#cb28-52" tabindex="-1"></a>  zip_results <span class="ot">&lt;-</span> zip_results[nrows <span class="sc">!=</span> <span class="fu">min</span>(nrows), ] <span class="co">#remove the states file from consideration</span></span>
<span id="cb28-53"><a href="pls-data.html#cb28-53" tabindex="-1"></a>  zip_results[nrows <span class="sc">==</span> <span class="fu">max</span>(nrows),</span>
<span id="cb28-54"><a href="pls-data.html#cb28-54" tabindex="-1"></a>              response <span class="sc">:=</span> <span class="st">&#39;outlet&#39;</span>] <span class="co">#largest file will be outlets</span></span>
<span id="cb28-55"><a href="pls-data.html#cb28-55" tabindex="-1"></a>  zip_results[nrows <span class="sc">==</span> <span class="fu">min</span>(nrows),</span>
<span id="cb28-56"><a href="pls-data.html#cb28-56" tabindex="-1"></a>              response <span class="sc">:=</span> <span class="st">&#39;admin&#39;</span>] <span class="co">#remaining will be administrative entities</span></span>
<span id="cb28-57"><a href="pls-data.html#cb28-57" tabindex="-1"></a>  csvs <span class="ot">&lt;-</span> furrr<span class="sc">::</span><span class="fu">future_map2_chr</span>(<span class="at">.x =</span> zip_results<span class="sc">$</span>path,</span>
<span id="cb28-58"><a href="pls-data.html#cb28-58" tabindex="-1"></a>                                 <span class="at">.y =</span> zip_results<span class="sc">$</span>response,</span>
<span id="cb28-59"><a href="pls-data.html#cb28-59" tabindex="-1"></a>                                 <span class="at">.f =</span> get_pls_csv,</span>
<span id="cb28-60"><a href="pls-data.html#cb28-60" tabindex="-1"></a>                                 <span class="at">fy =</span> fy, <span class="at">here =</span> here)</span>
<span id="cb28-61"><a href="pls-data.html#cb28-61" tabindex="-1"></a>  <span class="co"># Clean up</span></span>
<span id="cb28-62"><a href="pls-data.html#cb28-62" tabindex="-1"></a>  process_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> fp, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-63"><a href="pls-data.html#cb28-63" tabindex="-1"></a>    <span class="fu">setdiff</span>(zipfile) <span class="co">#Get everything but the original zip</span></span>
<span id="cb28-64"><a href="pls-data.html#cb28-64" tabindex="-1"></a>  <span class="fu">unlink</span>(process_files, <span class="at">recursive =</span> <span class="cn">TRUE</span>) <span class="co">#Delete</span></span>
<span id="cb28-65"><a href="pls-data.html#cb28-65" tabindex="-1"></a>  csvs <span class="co">#return paths to created files</span></span>
<span id="cb28-66"><a href="pls-data.html#cb28-66" tabindex="-1"></a>}</span>
<span id="cb28-67"><a href="pls-data.html#cb28-67" tabindex="-1"></a></span>
<span id="cb28-68"><a href="pls-data.html#cb28-68" tabindex="-1"></a><span class="co">#&#39; Use list of PLS URLs</span></span>
<span id="cb28-69"><a href="pls-data.html#cb28-69" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb28-70"><a href="pls-data.html#cb28-70" tabindex="-1"></a><span class="co">#&#39; @param pls Character vector of PLS URLs (see `get_pls_urls()`); expects to find names in `fy20..` format also.</span></span>
<span id="cb28-71"><a href="pls-data.html#cb28-71" tabindex="-1"></a><span class="co">#&#39; @param extract Fallback regex to get the names described above.</span></span>
<span id="cb28-72"><a href="pls-data.html#cb28-72" tabindex="-1"></a><span class="co">#&#39; @param here String describing the intended destination path. Default `&#39;data/raw/PLS_csvs&#39;`. Needs refinement as a feature.</span></span>
<span id="cb28-73"><a href="pls-data.html#cb28-73" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb28-74"><a href="pls-data.html#cb28-74" tabindex="-1"></a><span class="co">#&#39; @return Returns a list of the filenames being produced.</span></span>
<span id="cb28-75"><a href="pls-data.html#cb28-75" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb28-76"><a href="pls-data.html#cb28-76" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb28-77"><a href="pls-data.html#cb28-77" tabindex="-1"></a>get_pls_data <span class="ot">&lt;-</span> \(pls,</span>
<span id="cb28-78"><a href="pls-data.html#cb28-78" tabindex="-1"></a>                  <span class="at">extract =</span> <span class="st">&#39;fy20..&#39;</span>,</span>
<span id="cb28-79"><a href="pls-data.html#cb28-79" tabindex="-1"></a>                  <span class="at">here =</span> <span class="st">&#39;data/raw/PLS_csvs&#39;</span>) {</span>
<span id="cb28-80"><a href="pls-data.html#cb28-80" tabindex="-1"></a>  files <span class="ot">&lt;-</span> furrr<span class="sc">::</span><span class="fu">future_map</span>(<span class="at">.x =</span> pls, <span class="at">.f =</span> get_pls_data,</span>
<span id="cb28-81"><a href="pls-data.html#cb28-81" tabindex="-1"></a>                             <span class="at">extract =</span> extract, <span class="at">here =</span> here)</span>
<span id="cb28-82"><a href="pls-data.html#cb28-82" tabindex="-1"></a>}</span></code></pre></div>
<p>The utility functions <code>check_nrow</code> and <code>check_nrows</code> were custom (in <code>R/utils.R</code>):</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="pls-data.html#cb29-1" tabindex="-1"></a><span class="co">#&#39; Number of rows in a fread-legible file</span></span>
<span id="cb29-2"><a href="pls-data.html#cb29-2" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb29-3"><a href="pls-data.html#cb29-3" tabindex="-1"></a><span class="co">#&#39; @description</span></span>
<span id="cb29-4"><a href="pls-data.html#cb29-4" tabindex="-1"></a><span class="co">#&#39; Uses `data.table::fread()` to determine `nrow` for a file without actually loading all of its contents.</span></span>
<span id="cb29-5"><a href="pls-data.html#cb29-5" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb29-6"><a href="pls-data.html#cb29-6" tabindex="-1"></a><span class="co">#&#39; @param file Path to the file being evaluated.</span></span>
<span id="cb29-7"><a href="pls-data.html#cb29-7" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb29-8"><a href="pls-data.html#cb29-8" tabindex="-1"></a><span class="co">#&#39; @returns Returns an integer `nrow` value.</span></span>
<span id="cb29-9"><a href="pls-data.html#cb29-9" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb29-10"><a href="pls-data.html#cb29-10" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb29-11"><a href="pls-data.html#cb29-11" tabindex="-1"></a>check_nrow <span class="ot">&lt;-</span> \(<span class="at">file =</span> filename) {</span>
<span id="cb29-12"><a href="pls-data.html#cb29-12" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">is.readable</span>(file) <span class="co">#check filename</span></span>
<span id="cb29-13"><a href="pls-data.html#cb29-13" tabindex="-1"></a>  n <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="at">file =</span> file, <span class="at">select =</span> 1L) <span class="sc">%&gt;%</span></span>
<span id="cb29-14"><a href="pls-data.html#cb29-14" tabindex="-1"></a>    <span class="fu">nrow</span>()</span>
<span id="cb29-15"><a href="pls-data.html#cb29-15" tabindex="-1"></a>}</span>
<span id="cb29-16"><a href="pls-data.html#cb29-16" tabindex="-1"></a></span>
<span id="cb29-17"><a href="pls-data.html#cb29-17" tabindex="-1"></a><span class="co">#&#39; Vectorized `check_nrow()`</span></span>
<span id="cb29-18"><a href="pls-data.html#cb29-18" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb29-19"><a href="pls-data.html#cb29-19" tabindex="-1"></a><span class="co">#&#39; @description</span></span>
<span id="cb29-20"><a href="pls-data.html#cb29-20" tabindex="-1"></a><span class="co">#&#39; Uses `data.table::fread()` to determine `nrow` for multiple files without actually loading their contents. Returns a vector of results in the original order.</span></span>
<span id="cb29-21"><a href="pls-data.html#cb29-21" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb29-22"><a href="pls-data.html#cb29-22" tabindex="-1"></a><span class="co">#&#39; @param files Character vector of one or more file paths. (If it&#39;s only one, you should probably be using `check_nrow()` on its own.)</span></span>
<span id="cb29-23"><a href="pls-data.html#cb29-23" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb29-24"><a href="pls-data.html#cb29-24" tabindex="-1"></a><span class="co">#&#39; @returns Returns an integer vector corresponding to the `nrow` results in order.</span></span>
<span id="cb29-25"><a href="pls-data.html#cb29-25" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb29-26"><a href="pls-data.html#cb29-26" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb29-27"><a href="pls-data.html#cb29-27" tabindex="-1"></a>check_nrows <span class="ot">&lt;-</span> \(<span class="at">files =</span> <span class="fu">c</span>()) {</span>
<span id="cb29-28"><a href="pls-data.html#cb29-28" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">is.vector</span>(files, <span class="at">mode =</span> <span class="st">&#39;character&#39;</span>))</span>
<span id="cb29-29"><a href="pls-data.html#cb29-29" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> furrr<span class="sc">::</span><span class="fu">future_map_int</span>(<span class="at">.x =</span> files, <span class="at">.f =</span> check_nrow)</span>
<span id="cb29-30"><a href="pls-data.html#cb29-30" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="logic.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="e-rate-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
